# 프로젝트 아키텍처

**아키텍처 패턴**: MVVM (Model-View-ViewModel) + Feature-Based

---

## 목차

1. [아키텍처 개요](#1-아키텍처-개요)
2. [레이어 구조](#2-레이어-구조)
3. [실제 프로젝트 구조](#3-실제-프로젝트-구조)
4. [데이터 흐름](#4-데이터-흐름)
5. [Riverpod 상태 관리](#5-riverpod-상태-관리)
6. [예제 코드](#6-예제-코드)
7. [위젯 아키텍처](#7-위젯-아키텍처)
8. [Clean Architecture와 비교](#8-clean-architecture와-비교)

---

## 1. 아키텍처 개요

### 1.1 아키텍처 패턴

이 프로젝트는 다음 패턴을 조합하여 사용합니다:

- **MVVM (Model-View-ViewModel)**: 상태 관리와 UI 분리
- **Feature-Based Structure**: 기능별 모듈 분리
- **Datasource 패턴**: 데이터 소스 직접 사용
- **Dependency Injection**: Riverpod을 통한 DI

### 1.2 핵심 원칙

1. **Feature 기반 분리**: 각 feature는 독립적인 모듈
2. **간결한 구조**: ViewModel이 Datasource를 직접 사용
3. **실용적 접근**: 복잡한 추상화 없이 빠른 개발
4. **확장 가능**: 필요 시 Repository 패턴으로 확장 가능

### 1.3 Clean Architecture와의 차이

| 특징 | MVVM (이 프로젝트) | Clean Architecture |
|------|-------------------|-------------------|
| 레이어 수 | 3개 (View, ViewModel, Datasource) | 5개 이상 (View, ViewModel, UseCase, Repository, Datasource) |
| 추상화 레벨 | 낮음 (직접 사용) | 높음 (인터페이스 기반) |
| 개발 속도 | 빠름 | 느림 |
| 테스트 용이성 | 보통 | 높음 |
| 확장성 | 보통 | 높음 |
| 학습 곡선 | 낮음 | 높음 |
| 적합한 프로젝트 | 중소규모, 빠른 개발 | 대규모, 장기 유지보수 |

---

## 2. 레이어 구조

### 2.1 전체 흐름

```
View → ViewModel → Datasource → Service
```

**MVVM 데이터 흐름**:
- **View**: UI 렌더링 및 사용자 입력 처리
- **ViewModel**: 상태 관리 및 Datasource 호출
- **Datasource**: 실제 데이터 처리 (Supabase/Firebase)
- **Service**: 외부 SDK 래퍼 (SupabaseService, FirebaseService)

### 2.2 각 레이어의 역할

#### 1. View (Presentation Layer)
**위치**: `lib/features/*/presentation/pages/`

**역할**:
- UI 렌더링
- 사용자 입력 처리
- ViewModel과 상호작용

**특징**:
- `ConsumerWidget` 또는 `ConsumerStatefulWidget` 사용
- Riverpod Provider를 통해 ViewModel 접근
- 비즈니스 로직 포함하지 않음

**예시**:
```dart
class ProfileScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final authResult = ref.watch(authViewModelProvider);
    
    return authResult.when(
      success: (user) => _buildProfile(user),
      failure: (message, _) => _buildError(message),
      pending: (_) => _buildLoading(),
    );
  }
}
```

---

#### 2. ViewModel (Presentation Layer)
**위치**: `lib/features/*/presentation/viewmodels/`

**역할**:
- 상태 관리 (StateNotifier)
- Datasource를 통한 데이터 처리
- UI 상태 관리

**특징**:
- `StateNotifier` 또는 `StateNotifierProvider` 사용
- **Datasource 직접 사용** (UseCase 없음)
- **Repository 없음**
- UI와 독립적 (테스트 용이)

**예시**:
```dart
class AuthViewModel extends StateNotifier<Result<User?>> {
  final SupabaseAuthDatasource _datasource;
  
  AuthViewModel(this._datasource) : super(Success<User?>(null));
  
  Future<void> signIn(AuthProvider provider) async {
    state = Pending<User?>('로그인 중...');
    final result = await _datasource.snsLogin(provider);
    state = result;
  }
}
```

---

#### 3. Model (Data Layer)
**위치**: `lib/features/*/models/`

**역할**:
- 데이터 모델 정의
- JSON 직렬화 포함
- 비즈니스 로직 포함 가능

**특징**:
- JSON 직렬화 포함 (`@JsonSerializable`)
- Datasource에서 직접 사용
- Domain Entity와 DTO 분리 없음

**예시**:
```dart
@JsonSerializable()
class User {
  final String id;
  final String name;
  final String email;
  @JsonKey(name: 'profile_image_url')
  final String? profileImageUrl;
  final String provider;
  @JsonKey(name: 'created_at')
  final String createdAt;
  
  // JSON 직렬화
  factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);
  Map<String, dynamic> toJson() => _$UserToJson(this);
  
  User({...});
  
  User copyWith({...}) {
    // ...
  }
}
```

---

#### 4. Datasource (Data Layer)
**위치**: `lib/features/*/data/datasources/`

**역할**:
- 특정 백엔드(Supabase/Firebase)의 구체적 구현
- Service를 사용하여 실제 API 호출
- Model을 사용하여 데이터 처리
- `Result<T>` 타입 반환

**특징**:
- Model을 사용하여 외부 데이터 처리
- Service 레이어에 의존
- 백엔드 교체 시 이 부분만 변경

**예시**:
```dart
class SupabaseAuthDatasource {
  Future<Result<User?>> snsLogin(AuthProvider provider) async {
    try {
      final response = await SupabaseService.client.auth.signInWithOAuth(...);
      final user = User.fromJson(response);
      return Success<User?>(user);
    } catch (e) {
      return Failure<User?>('로그인 실패: $e');
    }
  }
}
```

---

#### 5. Service (Core Layer)
**위치**: `lib/core/services/`

**역할**:
- 외부 SDK 래퍼 (Supabase, Firebase 등)
- 초기화 및 설정 관리
- SDK별 특화 로직

**구조**:
```
core/services/
├── external/              # 외부 서비스
│   ├── supabase_service.dart
│   └── firebase_service.dart
└── internal/              # 내부 서비스
    ├── auth_provider_service.dart
    ├── storage_service_interface.dart
    └── supabase_storage_service.dart
```

---

### 2.3 레이어별 의존성 규칙

```
 View → ViewModel (의존 가능)
 ViewModel → Datasource (의존 가능)
 Datasource → Service (의존 가능)
 Datasource → Model (의존 가능)

 View → Datasource (의존 불가)
 ViewModel → Service 직접 (의존 불가)
```

**의존성 방향**:
```
Presentation Layer (View, ViewModel)
    ↓ (의존)
Data Layer (Datasource, Model)
    ↓ (의존)
Core Layer (Services)
```

---

## 3. 실제 프로젝트 구조

### 3.1 전체 구조

```
lib/
├── main.dart                    # 앱 진입점
├── config/                      # 앱 설정
│   └── router.dart              # GoRouter 라우팅 설정
│
├── core/                        # 공통 모듈
│   ├── constants/               # 상수 정의
│   │   └── widget_data_keys.dart
│   ├── services/                # 서비스 레이어
│   │   ├── external/            # 외부 서비스 (Supabase, Firebase)
│   │   └── internal/            # 내부 서비스
│   │       ├── widget_data_service.dart
│   │       ├── widget_update_service.dart
│   │       └── deep_link_service.dart
│   ├── utils/                   # 유틸리티
│   │   └── result.dart          # Result 패턴
│   └── widgets/                 # 공통 위젯
│
└── features/                    # 기능별 모듈 (Feature-Based)
    ├── auth/                    # 인증 기능
    │   ├── data/                # Data Layer
    │   │   └── datasources/     # Data Sources
    │   │       ├── supabase_auth_datasource.dart
    │   │       ├── supabase_profile_datasource.dart
    │   │       └── supabase_follow_datasource.dart
    │   ├── models/              # Models
    │   │   └── user.dart        # User Model (JSON 직렬화 포함)
    │   └── presentation/        # Presentation Layer
    │       ├── providers/       # Provider 정의
    │       ├── viewmodels/      # ViewModels
    │       ├── pages/           # 화면
    │       └── widgets/         # Feature 전용 위젯
    │
    ├── feed/                    # 피드 기능
    │   ├── data/                # Data Layer
    │   │   └── datasources/     # Data Sources
    │   │       ├── supabase_post_datasource.dart
    │   │       ├── supabase_comment_datasource.dart
    │   │       └── supabase_like_datasource.dart
    │   ├── models/              # Models
    │   │   ├── post.dart        # Post Model
    │   │   └── comment.dart     # Comment Model
    │   └── presentation/        # Presentation Layer
    │       ├── providers/       # Provider 정의
    │       ├── viewmodels/      # ViewModels
    │       ├── pages/           # 화면
    │       └── widgets/         # Feature 전용 위젯
    │
    └── search/                  # 검색 기능
        ├── data/                # Data Layer
        │   └── datasources/     # Data Sources
        │       └── supabase_search_datasource.dart
        └── presentation/        # Presentation Layer
            ├── providers/       # Provider 정의
            ├── viewmodels/      # ViewModels
            └── widgets/         # Feature 전용 위젯
```

---

### 3.2 Feature 표준 구조

각 Feature는 다음 구조를 따릅니다:

```
features/{feature_name}/
├── data/                        # Data Layer
│   └── datasources/             # Data Sources
│       └── supabase_{feature}_datasource.dart
│
├── models/                      # Models
│   └── {model}.dart            # Model (JSON 직렬화 포함)
│
└── presentation/                # Presentation Layer
    ├── providers/               # Provider 정의
    │   └── providers.dart       # 통합 export
    ├── viewmodels/              # ViewModel
    │   └── {feature}_{action}_viewmodel.dart
    ├── pages/                   # 화면
    │   └── {feature}_{action}_screen.dart
    └── widgets/                 # Feature 전용 위젯
        └── {widget}.dart
```

---

### 3.3 현재 프로젝트의 실제 구조

#### Auth Feature
```
features/auth/
├── data/                        # Data Layer
│   └── datasources/             # Data Sources
│       ├── supabase_auth_datasource.dart
│       ├── supabase_profile_datasource.dart
│       └── supabase_follow_datasource.dart
│
├── models/                      # Models
│   └── user.dart                # User Model (JSON 직렬화 포함)
│
└── presentation/                # Presentation Layer
    ├── providers/               # Provider 정의
    │   └── providers.dart       # 통합 export
    ├── viewmodels/
    │   ├── auth_viewmodel.dart          # Datasource 직접 사용
    │   ├── profile_edit_viewmodel.dart  # Datasource 직접 사용
    │   └── follow_viewmodel.dart        # Datasource 직접 사용
    ├── pages/
    │   ├── auth_screen.dart
    │   ├── profile_screen.dart
    │   └── profile_edit_screen.dart
    └── widgets/
        └── user_profile_options_sheet.dart
```

#### Feed Feature
```
features/feed/
├── data/                        # Data Layer
│   └── datasources/             # Data Sources
│       ├── supabase_post_datasource.dart
│       ├── supabase_comment_datasource.dart
│       └── supabase_like_datasource.dart
│
├── models/                      # Models
│   ├── post.dart                # Post Model (JSON 직렬화 포함)
│   └── comment.dart             # Comment Model (JSON 직렬화 포함)
│
└── presentation/                # Presentation Layer
    ├── providers/               # Provider 정의
    │   └── providers.dart       # 통합 export
    ├── viewmodels/
    │   ├── post_list_viewmodel.dart      # Datasource 직접 사용
    │   ├── post_detail_viewmodel.dart    # Datasource 직접 사용
    │   ├── post_form_viewmodel.dart      # Datasource 직접 사용
    │   └── liked_posts_viewmodel.dart    # Datasource 직접 사용
    ├── pages/
    │   ├── post_list_screen.dart
    │   ├── post_detail_screen.dart
    │   ├── post_form_screen.dart
    │   └── liked_posts_screen.dart
    └── widgets/
        └── post_card.dart
```

#### Search Feature
```
features/search/
├── data/                        # Data Layer
│   └── datasources/             # Data Sources
│       └── supabase_search_datasource.dart
│
└── presentation/                # Presentation Layer
    ├── providers/               # Provider 정의
    │   └── providers.dart       # 통합 export
    ├── viewmodels/
    │   └── search_viewmodel.dart        # Datasource 직접 사용
    └── widgets/
        ├── comment_search_item.dart
        └── user_search_item.dart
```

---

## 4. 데이터 흐름

### 4.1 로그인 플로우 (MVVM)

```
1. View (AuthScreen)
   └─> 사용자가 "Google 로그인" 버튼 클릭
       └─> viewModel.signIn(AuthProvider.google) 호출

2. ViewModel (AuthViewModel)
   └─> _datasource.snsLogin(provider) 호출
       └─> 상태를 Pending으로 변경

3. Datasource (SupabaseAuthDatasource)
   └─> SupabaseService.client.auth.signInWithOAuth() 호출
       └─> 응답 데이터를 User.fromJson()으로 변환
       └─> Result<User?> 반환

4. Service (SupabaseService)
   └─> Supabase SDK를 통해 실제 API 호출
       └─> 결과 반환

5. 역순으로 결과 전달
   Service → Datasource → ViewModel → View
   
6. View 업데이트
   └─> authResult.when()으로 UI 상태 변경
```

### 4.2 게시글 목록 조회 플로우 (MVVM)

```
1. View (PostListScreen)
   └─> 화면 진입 시 자동 로드
       └─> ref.watch(postListViewModelProvider) 감시

2. ViewModel (PostListViewModel - autoDispose)
   └─> 화면 진입 시 자동 생성
       └─> _datasource.getPosts() 호출

3. Datasource (SupabasePostDatasource)
   └─> JOIN 쿼리 실행:
       .select('*, user_profiles!user_id(name, profile_image_url)')
       └─> Post.fromJson()로 Model 생성
       └─> Result<List<Post>> 반환

4. 역순으로 결과 전달
   Datasource → ViewModel → View

5. View 업데이트
   └─> 게시글 목록 표시 (작성자 정보 포함)
```

---

## 5. Riverpod 상태 관리

### 5.1 Riverpod이란?

**Riverpod**은 Flutter를 위한 강력한 상태 관리 및 의존성 주입 라이브러리입니다. 이 프로젝트에서 Riverpod은 다음과 같은 역할을 합니다:

1. **상태 관리**: ViewModel의 상태를 관리하고 UI에 반영
2. **의존성 주입**: Datasource, Service 등의 의존성을 주입
3. **자동 리빌드**: 상태 변경 시 관련 위젯 자동 업데이트
4. **메모리 관리**: 사용하지 않는 Provider 자동 해제

### 5.2 주요 개념

#### Provider

Provider는 값을 제공하는 객체입니다. Riverpod의 핵심 개념으로, 의존성 주입과 상태 관리를 담당합니다.

**종류**:
- `Provider<T>`: 단순 값 제공 (의존성 주입용)
- `StateNotifierProvider<T>`: 상태 관리용 (ViewModel)
- `FutureProvider<T>`: 비동기 데이터 제공
- `StreamProvider<T>`: 스트림 데이터 제공

#### StateNotifier

`StateNotifier`는 상태 변경 로직을 캡슐화하는 클래스입니다. ViewModel이 `StateNotifier`를 상속하여 상태를 관리합니다.

**특징**:
- `state` 속성으로 현재 상태 접근
- `state = newState`로 상태 변경
- 상태 변경 시 자동으로 UI 업데이트

#### ConsumerWidget

`ConsumerWidget`은 Provider를 사용하는 위젯입니다. `WidgetRef`를 통해 Provider에 접근할 수 있습니다.

**주요 메서드**:
- `ref.watch(provider)`: 상태 감시 및 자동 리빌드
- `ref.read(provider)`: 상태 읽기 (일회성, 이벤트 처리)
- `ref.listen(provider, callback)`: 상태 변경 감지 및 콜백 실행

### 5.3 Provider 구조

### 5.3.1 Provider 종류

#### Datasource Provider
```dart
// Datasource Provider (Data 레이어)
final supabaseAuthDatasourceProvider = Provider<SupabaseAuthDatasource>((ref) {
  return SupabaseAuthDatasource();
});
```

#### ViewModel Provider
```dart
// ViewModel Provider (Presentation 레이어)
final authViewModelProvider = StateNotifierProvider<AuthViewModel, Result<User?>>((ref) {
  final datasource = ref.watch(supabaseAuthDatasourceProvider);
  return AuthViewModel(datasource);
});
```

### 5.4 Provider 스코프 관리

#### 전역 스코프 (앱 전체 생명주기)
```dart
// StateNotifierProvider (전역)
final authViewModelProvider = StateNotifierProvider<AuthViewModel, Result<User?>>((ref) {
  final datasource = ref.watch(supabaseAuthDatasourceProvider);
  return AuthViewModel(datasource);
});
```

**사용 사례**:
- 인증 상태 (앱 전체에서 필요)
- 전역 설정

#### 위젯 스코프 (화면 진입 시 생성, 벗어나면 해제)
```dart
// StateNotifierProvider.autoDispose
final postListViewModelProvider = StateNotifierProvider.autoDispose<PostListViewModel, Result<List<Post>>>((ref) {
  final datasource = ref.watch(supabasePostDatasourceProvider);
  final viewModel = PostListViewModel(datasource);
  viewModel.loadPosts(); // 화면 진입 시 새로 로드
  return viewModel;
});
```

**사용 사례**:
- 게시글 목록 (화면을 벗어나면 해제)
- 게시글 상세 (특정 ID의 데이터)
- 폼 데이터 (임시 데이터)

#### Family (파라미터별 인스턴스)
```dart
// StateNotifierProvider.autoDispose.family
final postDetailViewModelProvider = StateNotifierProvider.autoDispose.family<PostDetailViewModel, PostDetailState, String>((ref, postId) {
  final datasource = ref.watch(supabasePostDatasourceProvider);
  final viewModel = PostDetailViewModel(datasource);
  viewModel.loadPost(postId);
  return viewModel;
});
```

**사용 사례**:
- 게시글 상세 (postId별 인스턴스)
- 사용자 프로필 (userId별 인스턴스)

### 5.5 현재 프로젝트의 Provider 스코프

#### 전역 스코프
- `authViewModelProvider` - 인증 상태 (앱 전체 필요)

#### autoDispose
- `postListViewModelProvider` - 게시글 목록
- `postFormViewModelProvider` - 게시글 작성/수정
- `profileEditViewModelProvider` - 프로필 편집

#### autoDispose.family
- `postDetailViewModelProvider` - 게시글 상세 (postId별)

### 5.6 ref.watch vs ref.read

#### ref.watch()

상태를 감시하고, 상태가 변경되면 자동으로 위젯을 리빌드합니다.

**사용 시기**:
- UI에 표시할 데이터를 읽을 때
- 상태 변경 시 자동 업데이트가 필요할 때

**예제**:
```dart
class AuthScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // 상태 감시 - 변경 시 자동 리빌드
    final authResult = ref.watch(authViewModelProvider);
    
    return authResult.when(
      success: (user) => _buildProfile(user),
      failure: (message, _) => _buildError(message),
      pending: (_) => _buildLoading(),
    );
  }
}
```

#### ref.read()

상태를 한 번만 읽습니다. 리빌드를 트리거하지 않습니다.

**사용 시기**:
- 이벤트 핸들러에서 메서드 호출 시
- 일회성 작업 수행 시

**예제**:
```dart
ElevatedButton(
  onPressed: () {
    // 일회성 호출 - 리빌드 트리거 안 함
    ref.read(authViewModelProvider.notifier).signIn(AuthProvider.google);
  },
  child: Text('Google 로그인'),
)
```

### 5.7 장점

1. **메모리 효율**: 사용하지 않는 ViewModel 자동 해제
2. **데이터 최신성**: 화면 재진입 시 최신 데이터 로드
3. **코드 단순화**: 수동 invalidate 감소
4. **성능 향상**: 불필요한 상태 유지 방지

---

## 6. 예제 코드

### 6.1 MVVM 패턴 예제

#### Model
```dart
// features/auth/models/user.dart - Model (JSON 직렬화 포함)
@JsonSerializable()
class User {
  final String id;
  final String name;
  final String email;
  @JsonKey(name: 'profile_image_url')
  final String? profileImageUrl;
  final String provider;
  @JsonKey(name: 'created_at')
  final String createdAt;
  
  factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);
  Map<String, dynamic> toJson() => _$UserToJson(this);
  
  User({...});
  
  User copyWith({...}) {
    // ...
  }
}
```

#### Datasource
```dart
// features/auth/data/datasources/supabase_auth_datasource.dart - Datasource
class SupabaseAuthDatasource {
  Future<Result<User?>> snsLogin(AuthProvider provider) async {
    try {
      final response = await SupabaseService.client.auth.signInWithOAuth(...);
      final user = User.fromJson(response);
      return Success<User?>(user);
    } catch (e) {
      return Failure<User?>('로그인 실패: $e');
    }
  }
}
```

#### ViewModel
```dart
// features/auth/presentation/viewmodels/auth_viewmodel.dart - ViewModel
class AuthViewModel extends StateNotifier<Result<User?>> {
  final SupabaseAuthDatasource _datasource;
  
  AuthViewModel(this._datasource) : super(Success<User?>(null));
  
  Future<void> signIn(AuthProvider provider) async {
    state = Pending<User?>('로그인 중...');
    final result = await _datasource.snsLogin(provider);
    state = result;
  }
}
```

#### View
```dart
// features/auth/presentation/pages/auth_screen.dart - View
class AuthScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final authResult = ref.watch(authViewModelProvider);
    
    return authResult.when(
      success: (user) => user == null ? _buildLoginButtons(ref) : _buildLoggedIn(user),
      failure: (message, _) => _buildError(message),
      pending: (_) => _buildLoading(),
    );
  }
  
  Widget _buildLoginButtons(WidgetRef ref) {
    return Column(
      children: [
        ElevatedButton(
          onPressed: () => ref.read(authViewModelProvider.notifier).signIn(AuthProvider.google),
          child: Text('Google 로그인'),
        ),
      ],
    );
  }
}
```

#### Provider
```dart
// features/auth/presentation/providers/providers.dart - Provider
final supabaseAuthDatasourceProvider = Provider<SupabaseAuthDatasource>((ref) {
  return SupabaseAuthDatasource();
});

final authViewModelProvider = StateNotifierProvider<AuthViewModel, Result<User?>>((ref) {
  final datasource = ref.watch(supabaseAuthDatasourceProvider);
  return AuthViewModel(datasource);
});
```

---

## 7. 위젯 아키텍처

### 7.1 위젯 데이터 흐름

```
┌─────────────┐
│   Supabase  │
│  (Database) │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│ WidgetDataService│ ◄── 사용자 통계 집계
└──────┬──────────┘
       │
       ▼
┌──────────────────┐
│ SharedPreferences│ ◄── 데이터 저장 (Flutter)
└──────┬───────────┘
       │
       ├─────────────────┬─────────────────┐
       ▼                 ▼                 ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│   Android   │  │     iOS     │  │   Flutter   │
│   Widget    │  │   Widget    │  │     App     │
│  (Glance)   │  │ (WidgetKit) │  │             │
└─────────────┘  └─────────────┘  └─────────────┘
```

### 7.2 주요 컴포넌트

#### Flutter 측
- **WidgetDataService** (`lib/core/services/internal/widget_data_service.dart`): 데이터 집계 및 저장
- **WidgetUpdateService** (`lib/core/services/internal/widget_update_service.dart`): Method Channel 통신
- **DeepLinkService** (`lib/core/services/internal/deep_link_service.dart`): Deep Link 처리
- **WidgetDataKeys** (`lib/core/constants/widget_data_keys.dart`): SharedPreferences 키 관리

#### Android 측
- **HomeWidget.kt**: Jetpack Compose Glance 위젯 UI
- **HomeWidgetReceiver.kt**: 위젯 리시버
- **MainActivity.kt**: Method Channel 및 Deep Link 처리

#### iOS 측
- **HomeWidget.swift**: WidgetKit Extension (SwiftUI)
- **AppDelegate.swift**: Method Channel 처리

### 7.3 위젯 업데이트 트리거

위젯은 다음 시점에 자동으로 업데이트됩니다:

1. **앱 시작 시** (`MainNavigationScreen`)
2. **로그인/로그아웃 시** (`AuthViewModel`)
3. **게시글 작성/수정 시** (`PostFormScreen`)

---

## 8. Clean Architecture와 비교

### 8.1 구조 비교

#### MVVM (이 프로젝트)
```
View → ViewModel → Datasource → Service
```

**특징**:
- 간결한 구조
- 빠른 개발
- Datasource 직접 사용
- Model에 JSON 직렬화 포함

#### Clean Architecture
```
View → ViewModel → UseCase → Repository → Datasource → Service
```

**특징**:
- 복잡한 구조
- 높은 추상화
- UseCase 패턴
- Repository 패턴
- DTO와 Entity 분리

### 8.2 언제 어떤 것을 선택할까?

#### MVVM 선택 권장
- 중소규모 프로젝트
- 빠른 개발이 필요한 경우
- 단일 백엔드 사용
- 간단한 CRUD 작업
- 학습 곡선을 낮게 유지하고 싶을 때

#### Clean Architecture 선택 권장
- 대규모 프로젝트
- 복잡한 비즈니스 로직
- 여러 백엔드 교체 가능성
- 높은 테스트 커버리지 필요
- 장기 유지보수 중요

### 8.3 이 프로젝트의 특징

**현재 프로젝트는 MVVM 패턴을 사용**합니다:

- ViewModel이 Datasource를 직접 사용
- Repository 패턴 없음
- UseCase 패턴 없음
- Model에 JSON 직렬화 포함 (DTO 분리 없음)
- 간결하고 실용적인 구조

**장점**:
- 빠른 개발 속도
- 낮은 학습 곡선
- 간단한 구조
- 실용적 접근

**단점**:
- 백엔드 교체 시 Datasource 전체 변경 필요
- 복잡한 비즈니스 로직 처리 시 ViewModel이 비대해질 수 있음
- 테스트 시 Mock Datasource 필요

---

## 9. 네이밍 컨벤션

### 파일명
- `*_datasource.dart`: Data Source
- `*_viewmodel.dart`: ViewModel
- `*_screen.dart`: Screen (또는 `*_page.dart`)
- `*_widget.dart`: Widget
- `*_providers.dart`: Providers
- `*.dart`: Model (예: `user.dart`, `post.dart`)

### 클래스명
- `*DataSource`: Data Source 클래스
- `*ViewModel`: ViewModel 클래스
- `*Screen`: Screen 클래스
- `*Widget`: Widget 클래스
- Model 클래스는 단수형 (예: `User`, `Post`, `Comment`)

### 변수명
- `*Provider`: Riverpod Provider
- `*Result`: Result 타입 변수
- `*State`: 상태 변수

---

## 10. 참고 문서

- [프로젝트 파일 구조](./프로젝트_파일_구조.md) - 실제 파일 구조 상세 설명
- [설정/Supabase_초기_설정_가이드.md](../설정/Supabase_초기_설정_가이드.md) - 백엔드 설정
- [설정/위젯_구현_가이드.md](../설정/위젯_구현_가이드.md) - 위젯 구현 가이드
- [설정/다국어_가이드.md](../설정/다국어_가이드.md) - 다국어 처리 가이드
